Pending App Tasks

- Mobile Chat Auto Refresh
- Search X in Agent and Workflow
- Excluding workflow sessions from chat and opening from workflow runs
- Cleanup documents
- Seed the Helper Agent and workflow
- Fresh install, Test and Push
- Plan saved at files/documentation-cleanup-plan.md in session state — just say "implement the documentation cleanup plan" in a future session
- Delete workflow to use Custom Dialog that we use for session delete
- What about features? Ralph and TaskBoard
- Conversation Id in the workflow YAML in online samples
-   ┌─────────────────────────────┬────────────────┬──────────────────────────────────────────────────────────────────────────────┐
  │ Phase                       │ Status         │ Notes                                                                        │
  ├─────────────────────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────┤
  │ W1: Foundation              │ ✅ Done        │ Models, storage, engine, run service, SSE streaming, AF integration verified │
  ├─────────────────────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────┤
  │ W2: Human Node + Edge Types │ ❌ Not started │ RequestInfoExecutor, conditional/switch/fan-out/fan-in                       │
  ├─────────────────────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────┤
  │ W3: API Routes              │ ✅ Done        │ Built during W1 (CRUD, run, SSE, input endpoints all working)                │
  ├─────────────────────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────┤
  │ W4: Frontend                │ ✅ Done        │ Library, Editor (YAML + Mermaid + run dialog), Run View, sidebar, history    │
  ├─────────────────────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────┤
  │ W5: LLM Workflow Design     │ ❌ Not started │ Chat pane for LLM-generated YAML                                             │
  ├─────────────────────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────┤
  │ W6: Types, Store & Tests    │ ⚠️ Partial     │ Types + API client + store done; tests exist but some pre-existing failures  │
  ├─────────────────────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────┤
  │ W7: Tool/MCP/Aggregator     │ ❌ Future      │ Standalone tool/MCP nodes                                                    │
  ├─────────────────────────────┼────────────────┼──────────────────────────────────────────────────────────────────────────────┤
  │ W8: Orchestration Patterns  │ ❌ Future      │ React Flow, Handoff/GroupChat/Magentic builders      


-  MathChat.yaml (student/teacher loop with condition check):

   kind: Workflow
   trigger:
     kind: OnConversationStart
     id: workflow_demo
     actions:
       - kind: InvokeAzureAgent
         id: question_student
         conversationId: =System.ConversationId
         agent:
           name: StudentAgent
       - kind: InvokeAzureAgent
         id: question_teacher
         conversationId: =System.ConversationId
         agent:
           name: TeacherAgent
         output:
           messages: Local.TeacherResponse
       - kind: SetVariable
         id: set_count_increment
         variable: Local.TurnCount
         value: =Local.TurnCount + 1
       - kind: ConditionGroup
         id: check_completion
         conditions:
           - condition: =!IsBlank(Find("CONGRATULATIONS", Upper(MessageText(Local.TeacherResponse))))
             id: check_turn_done
             actions:
               - kind: SendActivity
                 id: sendActivity_done
                 activity: GOLD STAR!
           - condition: =Local.TurnCount < 4
             id: check_turn_count
             actions:
               - kind: GotoAction
                 id: goto_student_agent
                 actionId: question_student
         elseActions:
           - kind: SendActivity
             id: sendActivity_tired
             activity: Let's try again later...

  ┌─────────────────────────────────────────┬───────────────┬──────────────────────────────────────────────────────────┬─────────────┐
  │ YAML Feature                            │ MathChat Uses │ Our Implementation                                       │ Compatible? │
  ├─────────────────────────────────────────┼───────────────┼──────────────────────────────────────────────────────────┼─────────────┤
  │ kind: Workflow                          │ ✅            │ ✅                                                       │ ✅          │
  ├─────────────────────────────────────────┼───────────────┼──────────────────────────────────────────────────────────┼─────────────┤
  │ OnConversationStart trigger             │ ✅            │ ✅                                                       │ ✅          │
  ├─────────────────────────────────────────┼───────────────┼──────────────────────────────────────────────────────────┼─────────────┤
  │ InvokeAzureAgent                        │ ✅            │ ✅                                                       │ ✅          │
  ├─────────────────────────────────────────┼───────────────┼──────────────────────────────────────────────────────────┼─────────────┤
  │ conversationId: =System.ConversationId  │ ✅            │ We don't use this — our agents don't share conversations │ ⚠️ Unknown  │
  ├─────────────────────────────────────────┼───────────────┼──────────────────────────────────────────────────────────┼─────────────┤
  │ output: messages: Local.TeacherResponse │ ✅            │ We haven't tested variable capture                       │ ⚠️ Unknown  │
  ├─────────────────────────────────────────┼───────────────┼──────────────────────────────────────────────────────────┼─────────────┤
  │ SetVariable                             │ ✅            │ Never tested                                             │ ⚠️ Unknown  │
  ├─────────────────────────────────────────┼───────────────┼──────────────────────────────────────────────────────────┼─────────────┤
  │ ConditionGroup with PowerFx             │ ✅            │ Phase W2 — not implemented                               │ ❌          │
  ├─────────────────────────────────────────┼───────────────┼──────────────────────────────────────────────────────────┼─────────────┤
  │ GotoAction (loop back)                  │ ✅            │ Never tested                                             │ ⚠️ Unknown  │
  ├─────────────────────────────────────────┼───────────────┼──────────────────────────────────────────────────────────┼─────────────┤
  │ SendActivity                            │ ✅            │ Never tested                                             │ ⚠️ Unknown  │
  └─────────────────────────────────────────┴───────────────┴──────────────────────────────────────────────────────────┴─────────────┘

  No — MathChat won't work with our current implementation. The core blocker is ConditionGroup with PowerFx expressions (IsBlank, Find, Upper, MessageText), which is Phase W2 scope. The looping (GotoAction)
  and variable tracking (SetVariable, Local.*) are also untested.

  Our current support is sequential pipelines only — agent A → agent B → agent C, which is what Marketing.yaml, Codebase Health Check, and Emoji Poem use.


Bugs:

- Mobile chat doesn't mark the viewed properly. If I chat in a session on mobile and go back to session list, it shows blue-dot 
- The agent file name remains old when renaming the agent. We wil need to fix it
- Why is workflow run not showing all the chat history from agents that are running as part of workflow
- Model not showing correct in workflow agent steps 
- Delete workflow, use the delete dialog
- Workflow run not taking user message
- Here's the breakdown — all pre-existing, none caused by our workflow work:

  ┌──────────────────────────┬───────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
  │ Category                 │ Count │ Root Cause                                                                                                                                                          │
  ├──────────────────────────┼───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
  │ 401 Unauthorized         │ 62    │ Auth middleware blocks test HTTP client. Tests were written before auth was added. Not our change.                                                                  │
  ├──────────────────────────┼───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
  │ test_state serialization │ 1     │ Our fix changed enum serialization from WorkflowRunState.IN_PROGRESS → in_progress (correct behavior). Test assertion needs updating but this was a deliberate fix. │
  ├──────────────────────────┼───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
  │ test_delete_run          │ 1     │ delete_run() returns WorkflowRun object instead of True. Pre-existing.                                                                                              │
  ├──────────────────────────┼───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┤
  │ test_agent_mcp_update    │ 1     │ KeyError: 'id' — pre-existing MCP test issue.                                                                                                                       │
  └──────────────────────────┴───────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

  182 tests pass. The 65 failures are:

   - 62 from auth middleware (all router/API tests) — existed before workflows
   - 2 from our deliberate behavior changes (enum serialization fix + delete return type)
   - 1 pre-existing MCP test bug

  None are regressions from our workflow feature work.


Tests:
- Verify if folder picker shows new folders automatically?
- How to create new workflow, how does it get build using chat? Workflow Agent?
- What will happen if I kill the server process in the middle of workflow run. What will be the state of the workflow when I restart the server? And will deleting the last run be allowed and it will cleanup
  folders
- Verify that workflow run is taking user prompt and passing to agent for creating poem
- Agent runs to delete related copilot sessions
- Status of the workflow run if server crashes during the running step & cleanup
- The agent file name remains old when renaming the agent. We will need to fix it
- Read onedrive and local DRM and non-DRM files from GHCP in VS Code
